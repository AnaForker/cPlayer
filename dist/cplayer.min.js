"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),cPlayer=function(){function t(e){var i=this;_classCallCheck(this,t);var n={play:[],pause:[],volumechange:[],timeupdate:[],canplaythrough:[],ended:[],toggle:[],previous:[],next:[],changeList:[],changeLyric:[],slideList:[],slideLyric:[],clickLyricPower:[],clickListPower:[],clickVolumePower:[]};this.emitter=new cEmitter(n),this.on=function(t,e){return i.emitter.on(t,e)};var s={element:document.getElementById("cplayer"),list:[],mdicon:!0};if(void 0!==Object.assign&&(this.options=Object.assign({},s,e)),this.options.mdicon!==!1){var r=document.createElement("link");r.rel="stylesheet","string"==typeof this.options.mdicon?r.href=this.options.mdicon:r.href="https://cdn.bootcss.com/material-design-icons/2.2.3/iconfont/material-icons.css",document.head.appendChild(r)}var a=function(t,e){return void 0!==e?e.getElementsByClassName(t)[0]:i.options.element.getElementsByClassName(t)[0]},o=function(t){return i.options.element.getElementsByTagName(t)[0]};this.now=0,this.dragging={contain:!1,target:void 0},function(){var t=document.createElement("c-player"),e=document.createElement("div");e.classList.add("lyric"),e.classList.add("invisible");var n=document.createElement("lyric-body");e.appendChild(n);var s=document.createElement("div");s.classList.add("controls");var r=document.createElement("div");r.classList.add("c-left");var a=document.createElement("div");a.classList.add("music-description");var o=document.createElement("div");o.classList.add("image");var l=document.createElement("img");l.classList.add("meta-bak"),o.appendChild(l);var c=document.createElement("div");c.classList.add("music-meta");var d=document.createElement("span");d.classList.add("music-name");var u=document.createElement("span");u.classList.add("music-artist"),c.appendChild(d),c.appendChild(u),a.appendChild(o),a.appendChild(c);var h=document.createElement("a");h.classList.add("play-icon");var m=document.createElement("i");m.classList.add("material-icons"),m.innerHTML="play_arrow",h.appendChild(m),r.appendChild(a),r.appendChild(h);var v=document.createElement("div");v.classList.add("c-center");var _=document.createElement("div");_.classList.add("time");var p=document.createElement("div");p.classList.add("time-body");var L=document.createElement("div");L.classList.add("time-line");var g=document.createElement("div");g.classList.add("time-point"),p.appendChild(L),p.appendChild(g),_.appendChild(p),v.appendChild(_);var y=document.createElement("div");y.classList.add("c-right");var f=document.createElement("div");f.classList.add("volume");var T=document.createElement("div");T.classList.add("volume-button");var w=document.createElement("a");w.classList.add("volume-power");var I=document.createElement("i");I.classList.add("material-icons"),I.innerHTML="volume_up",w.appendChild(I),T.appendChild(w);var E=document.createElement("div");E.classList.add("volume-body");var C=document.createElement("div");C.classList.add("volume-line");var k=document.createElement("div");k.classList.add("volume-point"),E.appendChild(C),E.appendChild(k),f.appendChild(T),f.appendChild(E);var S=document.createElement("div");S.classList.add("list-button");var b=document.createElement("a");b.classList.add("list-power");var P=document.createElement("i");P.classList.add("material-icons"),P.innerHTML="playlist_play",b.appendChild(P),S.appendChild(b);var N=document.createElement("div");N.classList.add("lyric-button");var B=document.createElement("a");B.classList.add("lyric-power");var M=document.createElement("i");M.classList.add("material-icons"),M.innerHTML="note",B.appendChild(M),N.appendChild(B),y.appendChild(f),y.appendChild(S),y.appendChild(N),s.appendChild(r),s.appendChild(v),s.appendChild(y);var H=document.createElement("div");H.classList.add("list"),H.classList.add("invisible");var j=document.createElement("list-body");H.appendChild(j),t.appendChild(e),t.appendChild(s),t.appendChild(H),i.options.element.appendChild(t)}(),this.__LIST__={lyric:a("lyric"),lyricBody:o("lyric-body"),toggle:a("play-icon"),img:a("meta-bak"),name:a("music-name"),artist:a("music-artist"),time:a("time"),timeLine:a("time-line"),timePoint:a("time-point"),lyricPower:a("lyric-power"),volumePower:a("volume-power"),volumeLine:a("volume-line"),volumePoint:a("volume-point"),listPower:a("list-power"),list:a("list"),listBody:o("list-body")},this.__LIST__.toggleIcon=a("material-icons",this.__LIST__.toggle),this.__LIST__.volumeIcon=a("material-icons",this.__LIST__.volumePower),this.music=new Audio,this.emitter.on("toggle",function(){i.isPaused()?i.play():i.pause()}).on("clickLyricPower",function(){i.hasLyric(i.now)&&i.__LIST__.lyric.classList.contains("invisible")?i.showLyric():i.hasLyric(i.now)&&!i.__LIST__.lyric.classList.contains("invisible")&&i.hideLyric()}).on("clickListPower",function(){i.hasList()&&i.__LIST__.list.classList.contains("invisible")?i.showList():i.hasLyric()&&!i.__LIST__.list.classList.contains("invisible")&&i.hideList()}).on("clickVolumePower",function(){i.isMuted()?i.music.muted=!1:i.volume(0)}).on("timeupdate",function(){i.updateTime(),i.hasLyric(i.now)&&i.slideLyric(i.music.currentTime)}).on("volumechange",function(){i.volume()}).on("pause",function(){}).on("play",function(){}).on("ended",function(){i.__LIST__.lyricBody.style.transform="",i.__LIST__.toggleIcon.innerHTML="play_arrow",i.options.list[i.now].loop===!0?(i.updateTime(0),i.play()):i.hasList()&&i.now!==i.options.list.length-1&&i.next()}),this.toggle(),this.__LIST__.toggle.addEventListener("click",function(){return i.emitter.emit("toggle")}),this.__LIST__.lyricPower.addEventListener("click",function(){return i.emitter.emit("clickLyricPower")}),this.__LIST__.listPower.addEventListener("click",function(){return i.emitter.emit("clickListPower")}),this.__LIST__.volumePower.addEventListener("click",function(){return i.emitter.emit("clickVolumePower")}),this.music.addEventListener("volumechange",function(t){return i.emitter.emit("volumechange",t)}),this.music.addEventListener("timeupdate",function(t){return i.emitter.emit("timeupdate",t)}),this.music.addEventListener("canplaythrough",function(){return i.emitter.emit("canplaythrough")}),this.music.addEventListener("pause",function(){return i.emitter.emit("pause")}),this.music.addEventListener("play",function(){return i.emitter.emit("play")}),this.music.addEventListener("ended",function(){return i.emitter.emit("ended")}),this.options.element.addEventListener("mousedown",function(t){return i.dragPercentage(t)}),this.options.element.addEventListener("mousemove",function(t){return i.dragPercentage(t)}),this.options.element.addEventListener("mouseup",function(t){return i.dragPercentage(t)}),this.volume(),this.refreshList()}return _createClass(t,[{key:"dragPercentage",value:function(t){switch(t.type){case"mousedown":if(t.target===this.__LIST__.timePoint&&t.target===this.__LIST__.volumePoint)return;this.dragging.contain=!0,this.dragging.target=t.target;break;case"mousemove":if(this.dragging.contain===!1)return;if(this.dragging.target.parentNode.classList.contains("volume-body")?this.__LIST__.volumeLine.style.width=(t.clientX-this.dragging.target.parentNode.offsetLeft)/this.dragging.target.parentNode.offsetWidth*100+"%":this.dragging.target.parentNode.classList.contains("time-body")&&(this.__LIST__.timeLine.style.width=(t.clientX-this.dragging.target.parentNode.offsetLeft)/this.dragging.target.parentNode.offsetWidth*100+"%"),this.dragging.target.parentNode.classList.contains("volume-body")){var e=(t.clientX-this.dragging.target.parentNode.offsetLeft)/this.dragging.target.parentNode.offsetWidth;e=e>1?1:e,e=e<0?0:e,this.music.volume=e}break;case"mouseup":if(this.dragging.contain===!1)return;if(this.dragging.target.parentNode.classList.contains("volume-body")){var i=(t.clientX-this.dragging.target.parentNode.offsetLeft)/this.dragging.target.parentNode.offsetWidth;i=i>1?1:i,i=i<0?0:i,this.music.volume=i}else if(this.dragging.target.parentNode.classList.contains("time-body")){var n=(t.clientX-this.dragging.target.parentNode.offsetLeft)/this.dragging.target.parentNode.offsetWidth;n=n>1?1:n,n=n<0?0:n,this.music.currentTime=n*this.music.duration}this.dragging.contain=!1,this.dragging.target=void 0}}},{key:"volume",value:function(){var t=arguments.length<=0||void 0===arguments[0]?void 0:arguments[0];return void 0===t?(this.__LIST__.volumeLine.style.width=100*this.music.volume+"%",this.isMuted()||(this.__LIST__.volumeIcon.innerHTML="volume_up"),this.isMuted()?0:this.music.volume):void(0===t?(this.music.muted=!0,this.__LIST__.volumeIcon.innerHTML="volume_mute"):(this.music.volume=t,this.__LIST__.volumeIcon.innerHTML="volume_up"))}},{key:"isMuted",value:function(){return this.music.muted}},{key:"play",value:function(){return this.music.seeking===!0?this:(this.music.play(),this)}},{key:"pause",value:function(){if(this.music.seeking!==!0)return this.music.pause(),this}},{key:"previous",value:function(){if(this.emitter.emit("previous"),0!==this.now)return this.now--,this.toggle(),this.play(),this}},{key:"next",value:function(){if(this.emitter.emit("next"),this.now!==this.options.list.length-1)return this.now++,this.toggle(),this.play(),this}},{key:"to",value:function(t){return this.now=t,this.toggle(),this.play(),this}},{key:"toggle",value:function(){var t=arguments.length<=0||void 0===arguments[0]?this.now:arguments[0];this.emitter.emit("toggle");var e=this.options.list[t],i=this.__LIST__;this.pause();var n=[e.image,e.name,e.artist,e.url];return i.img.src=n[0],i.name.innerHTML=n[1],i.artist.innerHTML=n[2],this.music.src=n[3],this.refreshLyric(),this.hasLyric(this.now)||this.hideLyric(),this.__LIST__.lyricBody.style.transform="",this}},{key:"isPaused",value:function(t){return void 0!==t&&t(),this.music.paused}},{key:"hasLyric",value:function(){var t=arguments.length<=0||void 0===arguments[0]?0:arguments[0],e=arguments[1];return void 0!==e&&e(),void 0!==this.options.list[t].lyric}},{key:"showLyric",value:function(){return this.emitter.emit("slideLyric",!0),this.hasLyric(this.now)&&this.__LIST__.lyric.classList.remove("invisible"),this.__LIST__.list.classList.contains("invisible")||this.hideList(),this}},{key:"hideLyric",value:function(){return this.emitter.emit("slideLyric",!1),this.__LIST__.lyric.classList.add("invisible"),this}},{key:"hasList",value:function(t){return void 0!==t&&t(),this.options.list.length>1}},{key:"showList",value:function(t){return this.emitter.emit("slideList",!0),this.__LIST__.list.classList.remove("invisible"),this.__LIST__.lyric.classList.contains("invisible")||this.hideLyric(),void 0!==t&&t(),this}},{key:"hideList",value:function(t){return this.emitter.emit("slideList",!1),this.__LIST__.list.classList.add("invisible"),void 0!==t&&t(),this}},{key:"refreshList",value:function(t){var e=this;this.emitter.emit("changeList");var i=this.options.list,n=this.__LIST__.listBody;n.innerHTML="";for(var s=function(t){var s=document.createElement("div");s.innerHTML='<span class="music-name">'+i[t].name+'</span><span class="music-artist">'+i[t].artist+"</span>",s=n.appendChild(s),s.addEventListener("click",function(){e.to(t)})},r=0;r<=i.length-1;r++)s(r);void 0!==t&&t()}},{key:"add",value:function(t,e){var i=this,n=this.options.list.push(t),s=document.createElement("div");s.innerHTML='<span class="music-name">'+t.name+'</span><span class="music-artist">'+t.artist+"</span>",s=this.__LIST__.listBody.appendChild(s),s.addEventListener("click",function(){i.to(n-1)}),void 0!==e&&e()}},{key:"lyric",value:function(){var t=arguments.length<=0||void 0===arguments[0]?void 0:arguments[0];if(void 0===t){if(this.hasLyric(this.now))return this.options.list[this.now].lyric}else this.options.list[this.now].lyric=t,this.refreshLyric();return this}},{key:"refreshLyric",value:function(){if(this.__LIST__.lyricBody.innerHTML="",this.hasLyric(this.now)){var t=this.options.list[this.now].lyric;t=t.split("\n");var e=[],i=!0,n=!1,s=void 0;try{for(var r,a=t[Symbol.iterator]();!(i=(r=a.next()).done);i=!0){var o=r.value;if("string"!=typeof o)break;for(var l=o.split(/\[|\]\[|\]/gi),c=0;c<l.length-1;c++)if(""!==l[c]||c===l.length-1){if(l[c].match(/\d{1,}\:\d{1,}/gi)){var d=l[c].split(/\:|\./gi);switch(d.length){case 2:l[c]=60*parseInt(d[0])+parseInt(d[1]);break;case 3:l[c]=60*parseInt(d[0])+parseInt(d[1])+parseFloat("0."+d[2]);break;default:throw new Error("Time not be Found!")}}}else l.splice(c,1),c--;e.push(l)}}catch(u){n=!0,s=u}finally{try{!i&&a["return"]&&a["return"]()}finally{if(n)throw s}}for(var h=[],m=e.length-1;m>=0;m--)if(e[m].length>2)for(var v=e[m].length-1;v>=0;v--)v!==e[m].length-1&&h.push({time:e[m][v],content:e[m][e[m].length-1]});else h.push({time:e[m][0],content:e[m][1]});h.sort(function(t,e){return t.time-e.time}),this.__LYRIC__=h;for(var _=0;_<=h.length-1;_++){var p=document.createElement("lrc");p.innerHTML=h[_].content,this.__LIST__.lyricBody.appendChild(p)}this.emitter.emit("changeLyric")}}},{key:"updateTime",value:function(){var t=arguments.length<=0||void 0===arguments[0]?void 0:arguments[0],e=arguments[1];return void 0!==t&&(this.music.currentTime=parseInt(t)),this.dragging.contain===!1&&(this.__LIST__.timeLine.style.width=this.music.currentTime/this.music.duration*100+"%"),void 0!==e&&e(this.music.currentTime),this.music.currentTime}},{key:"slideLyric",value:function(t){if(!this.__LIST__.lyric.classList.contains("invisible"))for(var e=this.__LYRIC__.length-1;e>=0;e--)if(void 0!==this.__LYRIC__[e+1]&&this.__LYRIC__[e].time<t&&this.__LYRIC__[e+1].time>t||void 0===this.__LYRIC__[e+1]&&this.__LYRIC__[e].time<t){null!==this.__LIST__.lyricBody.querySelector(".now")&&this.__LIST__.lyricBody.querySelector(".now")!==this.__LIST__.lyricBody.childNodes[e+1]&&this.__LIST__.lyricBody.querySelector(".now").classList.toggle("now"),this.__LIST__.lyricBody.childNodes[e].classList.toggle("now");var i=this.__LIST__.lyricBody.childNodes[e].offsetTop-this.__LIST__.lyricBody.childNodes[0].offsetTop-.5*this.__LIST__.lyricBody.childNodes[e].clientHeight,n=.5*this.__LIST__.lyric.clientHeight-this.__LIST__.lyricBody.childNodes[e].clientHeight,s=-(i-n);this.__LIST__.lyricBody.style.transform="translateY("+s+"px)"}}}]),t}();"function"!=typeof Object.assign&&(Object.assign=function(t){if(null==t)throw new TypeError("Cannot convert undefined or null to object");t=Object(t);for(var e=1;e<arguments.length;e++){var i=arguments[e];if(null!=i)for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t});var cEmitter=function(){function t(e){_classCallCheck(this,t),e?this.events=e:this.events=[]}return _createClass(t,[{key:"on",value:function(t,e){if(this.events[t]&&void 0!==this.events[t].push&&"function"==typeof e)this.events[t].push(e);else{if(void 0!==this.events[t]&&void 0!==this.events[t].push)throw new TypeError("Uncaught Unexcepted TypeError.");this.events[t]=[]}return this}},{key:"emit",value:function(t){for(var e=arguments.length,i=Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];for(var s=0;s<this.events[t].length;s++)this.events[t][s](i);return this}}]),t}();